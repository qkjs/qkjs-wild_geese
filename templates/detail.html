<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>用户详情</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; background: #f7f7f7; }
        .card { background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,.06); padding: 24px; }
        h1 { margin-top: 0; }
        .grid { display: grid; grid-template-columns: 160px 1fr; gap: 10px 18px; }
        .label { color: #666; }
        .value { color: #222; font-weight: 600; }
        .actions { margin-top: 24px; display: flex; gap: 12px; }
        a.btn { display: inline-block; padding: 10px 18px; text-decoration: none; border-radius: 6px; color: #fff; background: #007bff; }
        a.btn.secondary { background: #6c757d; }
        .json { white-space: pre-wrap; background: #f1f3f5; padding: 12px; border-radius: 6px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
        .flash { margin-bottom: 16px; padding: 10px; border-radius: 6px; background: #e7f3ff; color: #084298; border: 1px solid #b6d4fe; }
    </style>
    <script>
      // 前端兜底：若未登录，自动跳回登录页
      document.addEventListener('DOMContentLoaded', () => {
        try {
          const loggedIn = document.body.getAttribute('data-logged-in') === '1';
          if (!loggedIn) {
            window.location.href = '/auth/login';
          }
        } catch (e) {}
      });
    </script>
    {% set logged_in = 1 if session.user_id else 0 %}
</head>
<body data-logged-in="{{ logged_in }}">
    <div class="card">
        <h1>用户详情</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="flash">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {% if user %}
        <div class="grid">
            <div class="label">登录账号</div><div class="value">{{ user.user_id }}</div>
            <div class="label">账号类型</div><div class="value">{{ user.login_type }}</div>
            <div class="label">用户类型</div><div class="value">{{ user.user_type }}</div>
            <div class="label">账号状态</div><div class="value">{{ user.status }}</div>
            <div class="label">创建时间</div><div class="value">{{ user.created_at }}</div>
            <div class="label">更新时间</div><div class="value">{{ user.updated_at }}</div>

            <div class="label">姓名</div><div class="value">{{ user_info.full_name if user_info else '' }}</div>
            <div class="label">邮箱</div><div class="value">{{ user_info.email if user_info else '' }}</div>
            <div class="label">手机号</div><div class="value">{{ user_info.phone if user_info else '' }}</div>
            <div class="label">昵称</div><div class="value">{{ user_info.display_name if user_info else '' }}</div>
            <div class="label">年龄</div><div class="value">{{ user_info.age if user_info else '' }}</div>
            <div class="label">性别</div><div class="value">{{ user_info.gender if user_info else '' }}</div>
            <div class="label">地址</div><div class="value">{{ user_info.address if user_info else '' }}</div>
        </div>

        <h3>扩展资料</h3>
        <div class="json">{{ (user_info.extra_profile | tojson(indent=2)) if user_info and user_info.extra_profile else '—' }}</div>

        {% else %}
          <p>未找到用户。</p>
        {% endif %}

        <div class="actions">
            <a class="btn" href="/">返回首页</a>
            <a class="btn secondary" href="{{ url_for('auth.api_logout') }}">退出登录</a>
        </div>
    </div>
</body>
</html>
